<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Update Test</title>
</head>
<body>
    <h1>Testing Dashboard API</h1>
    <div id="results"></div>

    <script>
        async function testDashboardAPI() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing API...</p>';

            try {
                console.log('üîÑ Fetching from API...');
                const response = await fetch('https://acikl2oamh.execute-api.us-east-1.amazonaws.com/prod/data');
                const result = await response.json();

                console.log('‚úÖ API Response:', result);

                // Transform the data like the dashboard does
                const estimatedFlights = Math.floor(result.file_size_bytes / 200);
                const airborne = Math.floor(estimatedFlights * 0.85);
                const onGround = Math.floor(estimatedFlights * 0.15);

                results.innerHTML = `
                    <h2>API Test Results</h2>
                    <p><strong>API Response:</strong> ‚úÖ Success</p>
                    <p><strong>File Size:</strong> ${result.file_size_bytes} bytes</p>
                    <p><strong>Last Modified:</strong> ${result.last_modified}</p>
                    <p><strong>S3 Key:</strong> ${result.latest_file_key}</p>
                    <hr>
                    <h3>Calculated Dashboard Data:</h3>
                    <p><strong>Total Flights:</strong> ${estimatedFlights.toLocaleString()}</p>
                    <p><strong>Airborne:</strong> ${airborne.toLocaleString()}</p>
                    <p><strong>On Ground:</strong> ${onGround.toLocaleString()}</p>
                    <hr>
                    <p><em>This should match what appears on the dashboard if auto-update is working.</em></p>
                `;

            } catch (error) {
                console.error('‚ùå API Error:', error);
                results.innerHTML = `
                    <h2>API Test Results</h2>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check browser console for details.</p>
                `;
            }
        }

        // Test immediately and every 30 seconds
        testDashboardAPI();
        setInterval(testDashboardAPI, 30000);
    </script>
</body>
</html>
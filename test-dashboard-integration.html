<!DOCTYPE html>
<html>
<head>
    <title>Flight Data API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .result { background: #f5f5f5; padding: 20px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .metric { display: inline-block; margin: 10px; padding: 10px; background: white; border-radius: 5px; min-width: 150px; text-align: center; }
        .value { font-size: 24px; font-weight: bold; color: #007bff; }
        .label { font-size: 14px; color: #666; }
    </style>
</head>
<body>
    <h1>üõ©Ô∏è Flight Data API Integration Test</h1>
    <p>This page tests the API and shows the real data that should be displayed on your dashboard.</p>

    <div id="loading">üîÑ Loading real flight data from API...</div>
    <div id="results" style="display: none;">
        <div class="result success">
            <h2>‚úÖ API Working! Here's Your Real Flight Data:</h2>

            <div class="metric">
                <div class="value" id="total-flights">-</div>
                <div class="label">Total Flights</div>
            </div>

            <div class="metric">
                <div class="value" id="records-processed">-</div>
                <div class="label">Records Processed</div>
            </div>

            <div class="metric">
                <div class="value" id="airborne">-</div>
                <div class="label">Airborne</div>
            </div>

            <div class="metric">
                <div class="value" id="on-ground">-</div>
                <div class="label">On Ground</div>
            </div>

            <div style="clear: both; margin-top: 20px;">
                <h3>üåç Top Countries:</h3>
                <div id="countries"></div>

                <h3>üöÄ Fastest Aircraft:</h3>
                <div id="fastest"></div>

                <h3>üìä Technical Details:</h3>
                <div id="technical"></div>
            </div>
        </div>
    </div>

    <div id="error" style="display: none;" class="result error">
        <h2>‚ùå API Error</h2>
        <div id="error-details"></div>
    </div>

    <script>
        async function testAPI() {
            try {
                console.log('Testing API: https://acikl2oamh.execute-api.us-east-1.amazonaws.com/prod/data');

                const response = await fetch('https://acikl2oamh.execute-api.us-east-1.amazonaws.com/prod/data');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('API Response:', data);

                document.getElementById('loading').style.display = 'none';

                if (data.statistics && data.executionResult) {
                    // Success - real processed data
                    document.getElementById('results').style.display = 'block';

                    const stats = data.statistics;
                    const exec = data.executionResult;

                    // Update metrics
                    document.getElementById('total-flights').textContent = stats.total_flights.toLocaleString();
                    document.getElementById('records-processed').textContent = exec.records_processed.toLocaleString();
                    document.getElementById('airborne').textContent = stats.flights_airborne.toLocaleString();
                    document.getElementById('on-ground').textContent = stats.flights_on_ground.toLocaleString();

                    // Countries
                    let countriesHTML = '';
                    let rank = 1;
                    for (const [country, count] of Object.entries(stats.top_10_countries || {})) {
                        countriesHTML += `<div>${rank++}. ${country}: ${count.toLocaleString()} flights</div>`;
                        if (rank > 5) break; // Show top 5
                    }
                    document.getElementById('countries').innerHTML = countriesHTML;

                    // Fastest aircraft
                    let fastestHTML = '';
                    for (let i = 0; i < Math.min(3, (stats.top_10_fastest_aircraft || []).length); i++) {
                        const aircraft = stats.top_10_fastest_aircraft[i];
                        fastestHTML += `<div>${i+1}. ${aircraft.callsign} - ${aircraft.velocity_knots.toFixed(1)} knots (${aircraft.origin_country})</div>`;
                    }
                    document.getElementById('fastest').innerHTML = fastestHTML;

                    // Technical details
                    document.getElementById('technical').innerHTML = `
                        <div><strong>S3 Key:</strong> ${exec.s3_key}</div>
                        <div><strong>Execution ID:</strong> ${exec.execution_id}</div>
                        <div><strong>Data Timestamp:</strong> ${new Date(stats.data_timestamp).toLocaleString()}</div>
                        <div><strong>Status:</strong> ${exec.status}</div>
                        <div><strong>Mean Altitude:</strong> ${Math.round(stats.altitude_stats.mean_altitude_ft).toLocaleString()} ft</div>
                        <div><strong>Max Speed:</strong> ${Math.round(stats.speed_stats.max_speed_knots)} knots</div>
                    `;

                } else {
                    // Fallback - metadata only
                    throw new Error('API returned metadata only, not processed statistics');
                }

            } catch (error) {
                console.error('API Test Failed:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error-details').innerHTML = `
                    <div><strong>Error:</strong> ${error.message}</div>
                    <div><strong>API URL:</strong> https://acikl2oamh.execute-api.us-east-1.amazonaws.com/prod/data</div>
                    <div>Check browser console for more details.</div>
                `;
            }
        }

        // Run test when page loads
        testAPI();
    </script>
</body>
</html>